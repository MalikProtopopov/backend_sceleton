# –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å: –ü—Ä–æ–µ–∫—Ç—ã –∏ –ú–æ–¥—É–ª–∏

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–¥–µ–ª–∞ "–ü—Ä–æ–µ–∫—Ç—ã" –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –º–æ–¥—É–ª—è–º–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        ADMIN PANEL                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Sidebar                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                ‚îÇ
‚îÇ  ‚îÇ üè¢ –ü—Ä–æ–µ–∫—Ç—ã (platform_owner) ‚îÇ‚óÑ‚îÄ‚îÄ –¢–æ–ª—å–∫–æ –¥–ª—è platform_owner   ‚îÇ
‚îÇ  ‚îÇ   ‚îî‚îÄ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö tenants    ‚îÇ                                ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                                ‚îÇ
‚îÇ  ‚îÇ üìù –°—Ç–∞—Ç—å–∏     (blog_module) ‚îÇ‚óÑ‚îÄ‚îÄ –°–∫—Ä—ã—Ç–æ –µ—Å–ª–∏ disabled        ‚îÇ
‚îÇ  ‚îÇ üíº –ö–µ–π—Å—ã    (cases_module)  ‚îÇ                                ‚îÇ
‚îÇ  ‚îÇ ‚≠ê –û—Ç–∑—ã–≤—ã (reviews_module)  ‚îÇ                                ‚îÇ
‚îÇ  ‚îÇ ‚ùì FAQ        (faq_module)  ‚îÇ                                ‚îÇ
‚îÇ  ‚îÇ üë• –ö–æ–º–∞–Ω–¥–∞   (team_module)  ‚îÇ                                ‚îÇ
‚îÇ  ‚îÇ üìä –ó–∞—è–≤–∫–∏                   ‚îÇ‚óÑ‚îÄ‚îÄ –í—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–µ–Ω             ‚îÇ
‚îÇ  ‚îÇ ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏                ‚îÇ                                ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –†–æ–ª–∏ –∏ –¥–æ—Å—Ç—É–ø—ã

### –ò–µ—Ä–∞—Ä—Ö–∏—è —Ä–æ–ª–µ–π

| –†–æ–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ | –î–æ—Å—Ç—É–ø –∫ –ø—Ä–æ–µ–∫—Ç–∞–º | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è–º–∏ |
|------|----------|-------------------|---------------------|
| `superuser` | –°—É–ø–µ—Ä–∞–¥–º–∏–Ω | –í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã | –î–∞ |
| `platform_owner` | –í–ª–∞–¥–µ–ª–µ—Ü –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã | –í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã | –î–∞ |
| `site_owner` | –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∞–π—Ç–∞ | –¢–æ–ª—å–∫–æ —Å–≤–æ–π tenant | –ù–µ—Ç |
| `content_manager` | –ö–æ–Ω—Ç–µ–Ω—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä | –¢–æ–ª—å–∫–æ —Å–≤–æ–π tenant | –ù–µ—Ç |
| `marketer` | –ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥ | –¢–æ–ª—å–∫–æ —Å–≤–æ–π tenant | –ù–µ—Ç |
| `editor` | –†–µ–¥–∞–∫—Ç–æ—Ä | –¢–æ–ª—å–∫–æ —Å–≤–æ–π tenant | –ù–µ—Ç |

### Permissions (—Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è)

```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ "–ü—Ä–æ–µ–∫—Ç—ã"
const canManageProjects = user.is_superuser || user.role === 'platform_owner';

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –º–æ–¥—É–ª—è–º–∏
const canManageModules = user.permissions.includes('features:update') || 
                         user.permissions.includes('platform:*');
```

---

## API Endpoints

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

```http
GET /api/v1/auth/me
Authorization: Bearer {token}
```

**Response:**
```json
{
  "id": "uuid",
  "tenant_id": "63d068f7-7a47-46fe-aeb0-c82588e995a4",
  "email": "admin@example.com",
  "first_name": "Admin",
  "last_name": "User",
  "is_superuser": true,
  "role": {
    "name": "platform_owner",
    "description": "Platform administrator"
  },
  "permissions": [
    "platform:read",
    "platform:update",
    "features:read",
    "features:update",
    "articles:*",
    "cases:*",
    ...
  ]
}
```

---

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –¥–ª—è —Å–∞–π–¥–±–∞—Ä–∞

```http
GET /api/v1/auth/me/features
Authorization: Bearer {token}
```

**Response –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```json
{
  "enabled_features": ["blog_module", "cases_module", "reviews_module"],
  "all_features_enabled": false
}
```

**Response –¥–ª—è platform_owner/superuser:**
```json
{
  "enabled_features": [],
  "all_features_enabled": true
}
```

> **–í–∞–∂–Ω–æ:** –ï—Å–ª–∏ `all_features_enabled: true` ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã –≤ —Å–∞–π–¥–±–∞—Ä–µ.
> –ò–Ω–∞—á–µ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ, —á—Ç–æ –µ—Å—Ç—å –≤ `enabled_features`.

---

### 3. –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ platform_owner) {#list-projects}

```http
GET /api/v1/tenants?page=1&page_size=20&is_active=true
Authorization: Bearer {token}
```

**–î–æ—Å—Ç—É–ø:** `platform_owner`, `superuser`

**Response:**
```json
{
  "items": [
    {
      "id": "63d068f7-7a47-46fe-aeb0-c82588e995a4",
      "name": "–ö–ª–∏–Ω–∏–∫–∞ –≤–æ–ª–æ—Å",
      "slug": "hair-clinic",
      "domain": "hair-clinic.com",
      "is_active": true,
      "logo_url": "https://...",
      "primary_color": "#1E40AF",
      "contact_email": "admin@hair-clinic.com",
      "version": 5,
      "created_at": "2026-01-15T10:00:00Z",
      "settings": {
        "default_locale": "ru",
        "timezone": "Europe/Moscow"
      }
    }
  ],
  "total": 15,
  "page": 1,
  "page_size": 20
}
```

---

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

```http
GET /api/v1/tenants/{tenant_id}
Authorization: Bearer {token}
```

**–î–æ—Å—Ç—É–ø:**
- `platform_owner` / `superuser` ‚Üí –ª—é–±–æ–π tenant
- –û—Å—Ç–∞–ª—å–Ω—ã–µ ‚Üí —Ç–æ–ª—å–∫–æ —Å–≤–æ–π tenant

---

### 4. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ (—Ç–æ–ª—å–∫–æ platform_owner)

```http
POST /api/v1/tenants
Authorization: Bearer {token}
Content-Type: application/json
```

**Request:**
```json
{
  "name": "–ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç",
  "slug": "new-client",
  "domain": "new-client.com",
  "is_active": true,
  "contact_email": "admin@new-client.com",
  "primary_color": "#3B82F6"
}
```

---

### 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

```http
PATCH /api/v1/tenants/{tenant_id}
Authorization: Bearer {token}
Content-Type: application/json
```

**Request:**
```json
{
  "name": "–û–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ",
  "is_active": true,
  "version": 5
}
```

> ‚ö†Ô∏è `version` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è optimistic locking

---

### 6. –°–ø–∏—Å–æ–∫ feature flags (–º–æ–¥—É–ª–µ–π)

```http
GET /api/v1/feature-flags
Authorization: Bearer {token}
X-Tenant-ID: {tenant_id}
```

**–î–æ—Å—Ç—É–ø:** `platform_owner`, `superuser`

**Response:**
```json
{
  "items": [
    {
      "id": "uuid",
      "tenant_id": "63d068f7-7a47-46fe-aeb0-c82588e995a4",
      "feature_name": "cases_module",
      "enabled": true,
      "description": "Case studies / portfolio module"
    },
    {
      "id": "uuid",
      "tenant_id": "63d068f7-7a47-46fe-aeb0-c82588e995a4",
      "feature_name": "blog_module",
      "enabled": false,
      "description": "Blog / articles module"
    }
  ],
  "available_features": {
    "cases_module": "Case studies / portfolio module",
    "reviews_module": "Client testimonials module",
    "seo_advanced": "Advanced SEO features",
    "multilang": "Multi-language content support",
    "analytics_advanced": "Detailed lead analytics",
    "blog_module": "Blog / articles module",
    "faq_module": "FAQ module",
    "team_module": "Team / employees module"
  }
}
```

---

### 7. –í–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª—è

```http
PATCH /api/v1/feature-flags/{feature_name}
Authorization: Bearer {token}
X-Tenant-ID: {tenant_id}
Content-Type: application/json
```

**Request:**
```json
{
  "enabled": true
}
```

**Response:**
```json
{
  "id": "uuid",
  "tenant_id": "63d068f7-7a47-46fe-aeb0-c82588e995a4",
  "feature_name": "cases_module",
  "enabled": true,
  "description": "Case studies / portfolio module"
}
```

---

## –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥—É–ª–∏ (feature flags)

| Feature Name | –ù–∞–∑–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------------|----------|----------|
| `blog_module` | –ë–ª–æ–≥/–°—Ç–∞—Ç—å–∏ | –ú–æ–¥—É–ª—å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å—Ç–∞—Ç–µ–π |
| `cases_module` | –ö–µ–π—Å—ã | –ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ/Case studies |
| `reviews_module` | –û—Ç–∑—ã–≤—ã | –û—Ç–∑—ã–≤—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ |
| `faq_module` | FAQ | –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã |
| `team_module` | –ö–æ–º–∞–Ω–¥–∞ | –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∫–æ–º–ø–∞–Ω–∏–∏ |
| `multilang` | –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —è–∑—ã–∫–æ–≤ |
| `seo_advanced` | –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ SEO | Redirects, custom meta |
| `analytics_advanced` | –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ | UTM, geo, device tracking |

---

## Frontend Implementation

### TypeScript Interfaces

```typescript
// types/tenant.ts
export interface Tenant {
  id: string;
  name: string;
  slug: string;
  domain: string | null;
  is_active: boolean;
  logo_url: string | null;
  primary_color: string | null;
  contact_email: string | null;
  contact_phone: string | null;
  version: number;
  created_at: string;
  updated_at: string;
  settings: TenantSettings | null;
}

export interface TenantSettings {
  id: string;
  tenant_id: string;
  default_locale: string;
  timezone: string;
  date_format: string;
  time_format: string;
  notify_on_inquiry: boolean;
  inquiry_email: string | null;
  telegram_chat_id: string | null;
}

export interface FeatureFlag {
  id: string;
  tenant_id: string;
  feature_name: string;
  enabled: boolean;
  description: string | null;
  created_at: string;
  updated_at: string;
}

export interface FeatureFlagsResponse {
  items: FeatureFlag[];
  available_features: Record<string, string>;
}

export interface User {
  id: string;
  tenant_id: string;
  email: string;
  first_name: string;
  last_name: string;
  is_superuser: boolean;
  role: {
    name: string;
    description: string;
  } | null;
  permissions: string[];
}
```

### React Hooks

```typescript
// hooks/useProjects.ts
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { api } from '@/lib/api';

export function useProjects(page = 1, pageSize = 20, isActive?: boolean) {
  return useQuery({
    queryKey: ['tenants', page, pageSize, isActive],
    queryFn: async () => {
      const params = new URLSearchParams({
        page: String(page),
        page_size: String(pageSize),
      });
      if (isActive !== undefined) {
        params.append('is_active', String(isActive));
      }
      const { data } = await api.get(`/api/v1/tenants?${params}`);
      return data;
    },
  });
}

export function useProject(tenantId: string) {
  return useQuery({
    queryKey: ['tenant', tenantId],
    queryFn: async () => {
      const { data } = await api.get(`/api/v1/tenants/${tenantId}`);
      return data;
    },
    enabled: !!tenantId,
  });
}

export function useCreateProject() {
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: async (data: Partial<Tenant>) => {
      const { data: response } = await api.post('/api/v1/tenants', data);
      return response;
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['tenants'] });
    },
  });
}

export function useUpdateProject() {
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: async ({ id, ...data }: { id: string } & Partial<Tenant>) => {
      const { data: response } = await api.patch(`/api/v1/tenants/${id}`, data);
      return response;
    },
    onSuccess: (_, variables) => {
      queryClient.invalidateQueries({ queryKey: ['tenants'] });
      queryClient.invalidateQueries({ queryKey: ['tenant', variables.id] });
    },
  });
}
```

```typescript
// hooks/useFeatureFlags.ts
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { api } from '@/lib/api';

export function useFeatureFlags(tenantId: string) {
  return useQuery({
    queryKey: ['feature-flags', tenantId],
    queryFn: async () => {
      const { data } = await api.get('/api/v1/feature-flags', {
        headers: { 'X-Tenant-ID': tenantId },
      });
      return data as FeatureFlagsResponse;
    },
    enabled: !!tenantId,
  });
}

export function useToggleFeature(tenantId: string) {
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: async ({ featureName, enabled }: { featureName: string; enabled: boolean }) => {
      const { data } = await api.patch(
        `/api/v1/feature-flags/${featureName}`,
        { enabled },
        { headers: { 'X-Tenant-ID': tenantId } }
      );
      return data;
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['feature-flags', tenantId] });
    },
  });
}
```

### Sidebar Component

```tsx
// hooks/useEnabledFeatures.ts
import { useQuery } from '@tanstack/react-query';
import { api } from '@/lib/api';

interface EnabledFeaturesResponse {
  enabled_features: string[];
  all_features_enabled: boolean;
}

export function useEnabledFeatures() {
  return useQuery({
    queryKey: ['enabled-features'],
    queryFn: async () => {
      const { data } = await api.get<EnabledFeaturesResponse>('/api/v1/auth/me/features');
      return data;
    },
    staleTime: 5 * 60 * 1000, // 5 –º–∏–Ω—É—Ç
  });
}
```

```tsx
// components/Sidebar.tsx
import { useCurrentUser } from '@/hooks/useAuth';
import { useEnabledFeatures } from '@/hooks/useEnabledFeatures';

interface SidebarItem {
  name: string;
  href: string;
  icon: React.ComponentType;
  feature?: string; // –ü—Ä–∏–≤—è–∑–∫–∞ –∫ feature flag
  permission?: string; // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
}

const sidebarItems: SidebarItem[] = [
  // –í—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º—ã–µ
  { name: '–î–∞—à–±–æ—Ä–¥', href: '/dashboard', icon: HomeIcon },
  { name: '–ó–∞—è–≤–∫–∏', href: '/inquiries', icon: InboxIcon, permission: 'inquiries:read' },
  
  // –ó–∞–≤–∏—Å—è—Ç –æ—Ç feature flags
  { name: '–°—Ç–∞—Ç—å–∏', href: '/articles', icon: DocumentIcon, feature: 'blog_module', permission: 'articles:read' },
  { name: '–ö–µ–π—Å—ã', href: '/cases', icon: BriefcaseIcon, feature: 'cases_module', permission: 'cases:read' },
  { name: '–û—Ç–∑—ã–≤—ã', href: '/reviews', icon: StarIcon, feature: 'reviews_module', permission: 'reviews:read' },
  { name: 'FAQ', href: '/faq', icon: QuestionIcon, feature: 'faq_module', permission: 'faq:read' },
  { name: '–ö–æ–º–∞–Ω–¥–∞', href: '/team', icon: UsersIcon, feature: 'team_module', permission: 'employees:read' },
  
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
  { name: '–£—Å–ª—É–≥–∏', href: '/services', icon: CogIcon, permission: 'services:read' },
  { name: 'SEO', href: '/seo', icon: SearchIcon, permission: 'seo:read' },
  { name: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏', href: '/settings', icon: SettingsIcon, permission: 'settings:read' },
];

// –†–∞–∑–¥–µ–ª –¥–ª—è platform_owner
const platformItems: SidebarItem[] = [
  { name: '–ü—Ä–æ–µ–∫—Ç—ã', href: '/projects', icon: BuildingIcon },
];

export function Sidebar() {
  const { data: user } = useCurrentUser();
  const { data: features } = useEnabledFeatures();
  
  const isPlatformOwner = user?.is_superuser || user?.role?.name === 'platform_owner';
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
  const hasPermission = (permission?: string) => {
    if (!permission) return true;
    if (user?.is_superuser) return true;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –∏–ª–∏ wildcard
    const resource = permission.split(':')[0];
    return user?.permissions.includes(permission) || 
           user?.permissions.includes(`${resource}:*`);
  };
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞ –ª–∏ —Ñ–∏—á–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç)
  const isFeatureEnabled = (feature?: string) => {
    if (!feature) return true;
    // all_features_enabled=true –¥–ª—è platform_owner/superuser
    if (features?.all_features_enabled) return true;
    return features?.enabled_features.includes(feature) ?? false;
  };
  
  // –§–∏–ª—å—Ç—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å–∞–π–¥–±–∞—Ä–∞
  const visibleItems = sidebarItems.filter(item => 
    hasPermission(item.permission) && isFeatureEnabled(item.feature)
  );
  
  return (
    <nav className="sidebar">
      {/* –†–∞–∑–¥–µ–ª –ø—Ä–æ–µ–∫—Ç–æ–≤ –¥–ª—è platform_owner */}
      {isPlatformOwner && (
        <div className="sidebar-section">
          <h3 className="sidebar-section-title">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</h3>
          {platformItems.map(item => (
            <SidebarLink key={item.href} item={item} />
          ))}
        </div>
      )}
      
      {/* –û—Å–Ω–æ–≤–Ω–æ–µ –º–µ–Ω—é */}
      <div className="sidebar-section">
        <h3 className="sidebar-section-title">–ö–æ–Ω—Ç–µ–Ω—Ç</h3>
        {visibleItems.map(item => (
          <SidebarLink key={item.href} item={item} />
        ))}
      </div>
    </nav>
  );
}
```

### Projects Page

```tsx
// pages/projects/index.tsx
import { useState } from 'react';
import { useProjects } from '@/hooks/useProjects';
import { ProjectCard } from '@/components/ProjectCard';

export default function ProjectsPage() {
  const [page, setPage] = useState(1);
  const [filter, setFilter] = useState<boolean | undefined>(undefined);
  
  const { data, isLoading } = useProjects(page, 20, filter);
  
  return (
    <div className="projects-page">
      <header className="page-header">
        <h1>–ü—Ä–æ–µ–∫—Ç—ã</h1>
        <Button href="/projects/new">+ –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</Button>
      </header>
      
      {/* –§–∏–ª—å—Ç—Ä—ã */}
      <div className="filters">
        <Select
          value={filter === undefined ? 'all' : filter ? 'active' : 'inactive'}
          onChange={(v) => setFilter(v === 'all' ? undefined : v === 'active')}
        >
          <option value="all">–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã</option>
          <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
          <option value="inactive">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ</option>
        </Select>
      </div>
      
      {/* –°–µ—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ */}
      {isLoading ? (
        <Skeleton count={6} />
      ) : (
        <div className="projects-grid">
          {data?.items.map((project) => (
            <ProjectCard key={project.id} project={project} />
          ))}
        </div>
      )}
      
      {/* –ü–∞–≥–∏–Ω–∞—Ü–∏—è */}
      <Pagination
        page={page}
        totalPages={Math.ceil((data?.total || 0) / 20)}
        onPageChange={setPage}
      />
    </div>
  );
}
```

### Project Modules Page

```tsx
// pages/projects/[id]/modules.tsx
import { useParams } from 'next/navigation';
import { useProject } from '@/hooks/useProjects';
import { useFeatureFlags, useToggleFeature } from '@/hooks/useFeatureFlags';
import { Switch } from '@/components/ui/Switch';

// –ú–∞–ø–ø–∏–Ω–≥ feature_name -> —á–µ–ª–æ–≤–µ–∫–æ-–ø–æ–Ω—è—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∏–∫–æ–Ω–∫–∞
const FEATURE_META: Record<string, { name: string; icon: string; description: string }> = {
  blog_module: { 
    name: '–ë–ª–æ–≥ / –°—Ç–∞—Ç—å–∏', 
    icon: 'üìù',
    description: '–ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å—Ç–∞—Ç–µ–π –∏ –Ω–æ–≤–æ—Å—Ç–µ–π' 
  },
  cases_module: { 
    name: '–ö–µ–π—Å—ã / –ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ', 
    icon: 'üíº',
    description: '–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤' 
  },
  reviews_module: { 
    name: '–û—Ç–∑—ã–≤—ã', 
    icon: '‚≠ê',
    description: '–û—Ç–∑—ã–≤—ã –∫–ª–∏–µ–Ω—Ç–æ–≤' 
  },
  faq_module: { 
    name: 'FAQ', 
    icon: '‚ùì',
    description: '–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã' 
  },
  team_module: { 
    name: '–ö–æ–º–∞–Ω–¥–∞', 
    icon: 'üë•',
    description: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö' 
  },
  multilang: { 
    name: '–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å', 
    icon: 'üåê',
    description: '–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —è–∑—ã–∫–æ–≤' 
  },
  seo_advanced: { 
    name: '–†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ SEO', 
    icon: 'üîç',
    description: '–†–µ–¥–∏—Ä–µ–∫—Ç—ã, custom meta —Ç–µ–≥–∏' 
  },
  analytics_advanced: { 
    name: '–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞', 
    icon: 'üìä',
    description: 'UTM, geo, device tracking' 
  },
};

export default function ProjectModulesPage() {
  const { id: tenantId } = useParams<{ id: string }>();
  const { data: project } = useProject(tenantId);
  const { data: features, isLoading } = useFeatureFlags(tenantId);
  const toggleFeature = useToggleFeature(tenantId);
  
  const handleToggle = async (featureName: string, currentValue: boolean) => {
    await toggleFeature.mutateAsync({
      featureName,
      enabled: !currentValue,
    });
  };
  
  if (isLoading) return <Skeleton />;
  
  return (
    <div className="modules-page">
      <header className="page-header">
        <nav className="breadcrumb">
          <Link href="/projects">–ü—Ä–æ–µ–∫—Ç—ã</Link>
          <span>/</span>
          <Link href={`/projects/${tenantId}`}>{project?.name}</Link>
          <span>/</span>
          <span>–ú–æ–¥—É–ª–∏</span>
        </nav>
        <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è–º–∏</h1>
        <p className="text-muted">
          –í–∫–ª—é—á–∞–π—Ç–µ –∏ –æ—Ç–∫–ª—é—á–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ "{project?.name}"
        </p>
      </header>
      
      <div className="modules-grid">
        {features?.available_features && 
          Object.entries(features.available_features).map(([featureName, description]) => {
            const flag = features.items.find(f => f.feature_name === featureName);
            const isEnabled = flag?.enabled ?? false;
            const meta = FEATURE_META[featureName] || { 
              name: featureName, 
              icon: 'üì¶',
              description 
            };
            
            return (
              <div 
                key={featureName} 
                className={`module-card ${isEnabled ? 'enabled' : 'disabled'}`}
              >
                <div className="module-icon">{meta.icon}</div>
                <div className="module-info">
                  <h3 className="module-name">{meta.name}</h3>
                  <p className="module-description">{meta.description}</p>
                </div>
                <Switch
                  checked={isEnabled}
                  onChange={() => handleToggle(featureName, isEnabled)}
                  disabled={toggleFeature.isPending}
                />
              </div>
            );
          })
        }
      </div>
    </div>
  );
}
```

---

## –õ–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Å–∞–π–¥–±–∞—Ä–µ

### –ê–ª–≥–æ—Ä–∏—Ç–º

```typescript
function shouldShowSidebarItem(
  item: SidebarItem,
  user: User,
  enabledFeatures: Set<string>
): boolean {
  // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
  if (item.permission) {
    const hasPermission = checkPermission(user, item.permission);
    if (!hasPermission) return false;
  }
  
  // 2. –ï—Å–ª–∏ platform_owner - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å—ë
  if (user.is_superuser || user.role?.name === 'platform_owner') {
    return true;
  }
  
  // 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º feature flag
  if (item.feature && !enabledFeatures.has(item.feature)) {
    return false;
  }
  
  return true;
}
```

### –ú–∞–ø–ø–∏–Ω–≥ —Ä–∞–∑–¥–µ–ª–æ–≤ ‚Üí feature flags

| –†–∞–∑–¥–µ–ª –≤ —Å–∞–π–¥–±–∞—Ä–µ | Feature Flag | Permission |
|-------------------|--------------|------------|
| –î–∞—à–±–æ—Ä–¥ | - | - |
| –ó–∞—è–≤–∫–∏ | - | `inquiries:read` |
| –°—Ç–∞—Ç—å–∏ | `blog_module` | `articles:read` |
| –ö–µ–π—Å—ã | `cases_module` | `cases:read` |
| –û—Ç–∑—ã–≤—ã | `reviews_module` | `reviews:read` |
| FAQ | `faq_module` | `faq:read` |
| –ö–æ–º–∞–Ω–¥–∞ | `team_module` | `employees:read` |
| –£—Å–ª—É–≥–∏ | - | `services:read` |
| SEO | - | `seo:read` |
| –ù–∞—Å—Ç—Ä–æ–π–∫–∏ | - | `settings:read` |
| **–ü—Ä–æ–µ–∫—Ç—ã** | - | `platform:*` (—Ç–æ–ª—å–∫–æ platform_owner) |

---

## Best Practices

### 1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ feature flags

```typescript
// –ö—ç—à–∏—Ä—É–µ–º –Ω–∞ 5 –º–∏–Ω—É—Ç, –æ–±–Ω–æ–≤–ª—è–µ–º –≤ —Ñ–æ–Ω–µ
const { data: features } = useFeatureFlags(tenantId, {
  staleTime: 5 * 60 * 1000, // 5 –º–∏–Ω—É—Ç
  refetchOnWindowFocus: false,
});
```

### 2. Optimistic Updates –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π

```typescript
const toggleFeature = useToggleFeature(tenantId);

// –ü—Ä–∏ –∫–ª–∏–∫–µ —Å—Ä–∞–∑—É –º–µ–Ω—è–µ–º UI
const handleToggle = (featureName: string, enabled: boolean) => {
  // Optimistic update
  queryClient.setQueryData(['feature-flags', tenantId], (old) => ({
    ...old,
    items: old.items.map(f => 
      f.feature_name === featureName ? { ...f, enabled: !enabled } : f
    ),
  }));
  
  // –ó–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
  toggleFeature.mutate(
    { featureName, enabled: !enabled },
    {
      onError: () => {
        // –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º –ø—Ä–∏ –æ—à–∏–±–∫–µ
        queryClient.invalidateQueries(['feature-flags', tenantId]);
      },
    }
  );
};
```

### 3. –ó–∞—â–∏—Ç–∞ —Ä–æ—É—Ç–æ–≤

```typescript
// middleware.ts –∏–ª–∏ layout.tsx
import { redirect } from 'next/navigation';

export default function ProjectsLayout({ children }) {
  const { data: user } = useCurrentUser();
  
  const canAccessProjects = user?.is_superuser || 
                            user?.role?.name === 'platform_owner';
  
  if (!canAccessProjects) {
    redirect('/dashboard');
  }
  
  return children;
}
```

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ 403 –æ—à–∏–±–æ–∫

```typescript
// –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–º—É –º–æ–¥—É–ª—é
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 403) {
      const detail = error.response.data?.detail;
      
      if (detail?.includes('Feature') && detail?.includes('disabled')) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        toast.error('–≠—Ç–æ—Ç –º–æ–¥—É–ª—å –æ—Ç–∫–ª—é—á–µ–Ω –¥–ª—è –≤–∞—à–µ–≥–æ —Å–∞–π—Ç–∞');
        // –†–µ–¥–∏—Ä–µ–∫—Ç–∏–º –Ω–∞ –¥–∞—à–±–æ—Ä–¥
        router.push('/dashboard');
      }
    }
    return Promise.reject(error);
  }
);
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü

```
/projects                     # –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ (platform_owner only)
/projects/new                 # –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
/projects/[id]               # –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞
/projects/[id]/edit          # –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
/projects/[id]/modules       # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è–º–∏ (switchers)
/projects/[id]/settings      # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
/projects/[id]/users         # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞
```

---

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **X-Tenant-ID header** ‚Äî –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –ø—Ä–æ–µ–∫—Ç–æ–º –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–ü—Ä–æ–µ–∫—Ç—ã" –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ `X-Tenant-ID` –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –∑–∞–ø—Ä–æ—Å–æ–≤

2. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** ‚Äî –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ –ø—Ä–æ–µ–∫—Ç platform_owner —Ä–∞–±–æ—Ç–∞–µ—Ç "–æ—Ç –∏–º–µ–Ω–∏" —ç—Ç–æ–≥–æ tenant'–∞

3. **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ tenant –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `version` –¥–ª—è optimistic locking

4. **–õ–æ–≥–æ—Ç–∏–ø** ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º `POST /tenants/{id}/logo` —Å `multipart/form-data`
